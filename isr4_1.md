#### 4.1 На основе материалов преподавателя, рекомендованной литературы, а также ресурсов сети интернет (видеозаписи выступления по теме на конференциях) разработать конспект с примерами по использованию различных систем виртуализации проектов на Python. Требуется рассмотреть virtualenv, pipfile, pyenv, pipenv, venv. Привести примеры с разбором конфигурационных файлов 2 систем.
### Virtualenv
Virtualenv — это утилита, которая позволяет создавать изолированные виртуальные окружения для Python. По сути, она создаёт внутри вашего проекта каталог, в который кладёт нужную вам версию Python и туда же устанавливает все необходимые пакеты, которые вы будете использовать в своём приложении, фреймворке, скрипте. В результате вы получаете полностью рабочее, изолированное и переносимое окружение.

##### Этапы работы с virtualenv:

+ Установка virtualenv
+ Создание окружения
+ Активация окружения
+ Перенос окружения
+ Деактивация окружения

##### Установка virtualenv
```
pip install virtualenv
```

Для проверки использовать команду: ```virtualenv --version```

##### Создание окружения
Необходимо перейти в папку, в которой будет использоваться виртуальное окружение. Для создания окружения в папке используем, например, команду: ```virtualenv venv --python=python3.8```

“venv” в данном случае — это название директории, в которой будет развёрнуто виртуальное окружение.

##### Активация окружения
Окружение создано. Теперь, чтобы его использовать, нужно выполнить активацию. Это значит, что мы “переключаем контекст” выполнения команд связанных с python на виртуальное окружение. 

Выполним следующее: ```source venv/bin/activate```

Как только вы это сделаете, перед строкой приглашения вашей консоли появится “(venv)”.

Это значит, что контекст переключен и теперь используется виртуальное окружение.

##### Перенос окружения
Для начала делаем “слепок” списка пакетов с их версиями:
```
pip freeze > requirements.txt
```
где

```pip freeze``` — команда, которая выводит список всех установленных пакетов с их версиями.

```>``` — символ перенаправления вывода requirements.txt — имя файла, куда мы складываем список пакетов из pip freeze. Файл “requirements.txt” можно и нужно хранить в корне проекта и отдавать его в продакшн вместе с кодом. 

Итак, вы скачали файл requirements.txt вместе с вашим репозиторием на новую машину, и теперь вам нужно развернуть точно такое же окружение, какое было у вас на рабочей системе. Для этого вы по очереди выполняете команды из этого мануала, чтобы создать виртуальное окружение:
```
pip install virtualenv

cd <путь_к_репозиторию> 

virtualenv venv --python=<ваша_версия_python> 

source venv/bin/activate
```
и теперь устанавливаете необходимые вам пакеты, используя requirements.txt:
```
pip install -r requirements.txt
```
##### Деактивация окружения
Чтобы покинуть контекст вашего виртуального окружения и вернуться в систему, нужно выполнить
```
deactivate
```
### Pipfile
Pipfile предназначен для замены requirements.txt. Pipenv в настоящее время является эталонной реализацией использования Pipfile. Также стоит отметить, что Pipenv является официальным инструментом управления пакетами, рекомендованным самими разработчиками Python.

Синтаксис Pipfile – это TOML, где файл разделяется на разделы. [dev-packages] для пакетов только для разработки, [packages] для минимально необходимых пакетов и [requires] для других требований, таких как конкретная версия Python и т.п.

Рассмотрим пример файла:
```
[[source]]
url = "https://pypi.python.org/simple"
verify_ssl = true
name = "pypi"

[dev-packages]
pytest = "*"

[packages]
flask = "==0.12.1"
numpy = "*"
requests = {git = "https://github.com/requests/requests.git", editable = true}

[requires]
python_version = "3.6"
```
В идеале в Pipfile не должно быть никаких суб-зависимостей. Вы должны включать только те пакеты, которые вы на самом деле импортируете и используете. Pipfile должен хранить только зависимости верхнего уровня, необходимые для вашего проекта.

### Pyenv
Pyenv - это простой, мощный и кроссплатформенный инструмент для управления несколькими версиями Python в Linux-системах, он используется для:

+ переключения глобальной версии Python для каждого пользователя;
+ установки локальной версии Python для каждого проекта;
+ управления виртуальными средами, созданными anaconda или virtualenv;
+ переопределения версии Python с переменной окружения;
+ поиска команд из нескольких версий Python и для многого другого.

Как правило, версия Python по умолчанию используется для запуска всех ваших приложений, если вы явно не укажете версию, которую хотите использовать в приложении. Но pyenv реализует простую концепцию использования прокладок (легкие исполняемые файлы), чтобы передать вашу команду правильной версии Python, которую вы хотите использовать, когда у вас установлено несколько версий.

Эти прокладки вставлены pyenv в каталоги перед вашим PATH. Поэтому, когда вы запускаете команду Python, она перехватывается соответствующей прокладкой и передается в pyenv, который затем задает версию Python, указанную вашим приложением, и передает ваши команды правильной версии Python.

### Pipenv
Pipenv – это набирающий популярность пакет управления виртуальным окружением для Python, который решает некоторые распространенные проблемы, связанные с типичным рабочим процессом, в котором используется pip, virtualenv и старый добрый файл requirements.txt.
Pipenv – это инструмент, который призван привнести в мир Python лучшее из всех упаковочных миров (bundler, composer, npm, cargo, yarn и т. д.).

Помимо решения некоторых распространенных проблем, он стандартизицирует и упрощает процесс разработки с помощью единого инструмента командной строки.

Установка:
```
pip install pipenv
```
После этого можно фактически забыть о pip, поскольку Pipenv по сути выступает в качестве его замены. В нем также представлены два новых файла: Pipfile (который предназначен для замены requirements.txt) и Pipfile.lock (который отвечает за детерминированность сборки).

Pipenv использует pip и virtualenv под капотом, что упрощает их использование с помощью одного интерфейса командной строки.

### Venv
Этот модуль появился в Python3 и не может быть использован для решения задачи изоляции в Python2. По своему функционалу очень похож на virtualenv.

Основное отличие venv в том, что он встроен в интерпретатор и может отрабатывать ещё до загрузки системных модулей. Для этого, при определении базовой директории с библиотеками, используется примерно такой алгоритм:

+ в директории с интерпретатором или уровнем выше ищется файл с именем pyvenv.cfg;
+ если файл найден, в нём ищется ключ home, значение которого и будет базовой директорией;
+ в базовой директории идёт поиск системной библиотеки (по спец. маркеру os.py);
+ если что-то пошло не так – всё откатывается к захардкоженному в бинарнике значению.

Вот и вся суть venv, всё остальное уже обёртка над этим.

##### requirements.txt
+ Все требования в одном месте
Обычно для запуска проекта требуется несколько внешних пакетов.

Список этих пакетов принято поставлять вместе с исходным кодом. Принято селить весь список необходимых пакетов в файле requirements.txt в корне проекта. Формат этого файла простой: по одному пакету на строку.

+ Заморозка пакетов
У одного пакета обычно много версий. Когда мы просим pip установить пакет, он устанавливает самую свежую из доступных.

Это может привести к проблемам: например, проект разрабатывался на версии 1.2. Через полгода потребовалось развернуть его заново, pip установил последнюю версию – 1.5. Эта версия может быть не совместима со старой, тогда код сломается.


Чтобы такого не происходило, пакеты принято замораживать – указывать версию пакета вместе с названием. Pip поддерживает такой синтаксис: модуль==версия.

Получить все версии пакетов, установленных на вашем компьютере, можно командой pip freeze:
```
pip freeze
```
Все зависимости заморозить и в requirements.txt

##### Установка
Все пакеты из requirements.txt можно установить одним махом, pip такое умеет: ```pip install -r requirements.txt.```
